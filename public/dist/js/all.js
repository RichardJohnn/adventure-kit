(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Pixel = function Pixel(x, y) {
  _classCallCheck(this, Pixel);

  this.x = x;
  this.y = y;
  this.highlighted = false;
  this.color = null;
};

;

exports["default"] = Pixel;
module.exports = exports["default"];

},{}],2:[function(require,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _slicedToArray(arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }

var _pixel = require('./pixel');

var _pixel2 = _interopRequireDefault(_pixel);

document.addEventListener('DOMContentLoaded', function () {
  var bgCanvas = document.getElementById('bg-canvas');
  var drawCanvas = document.getElementById('draw-canvas');
  var overlayCanvas = document.getElementById('overlay-canvas');

  var bgCtx = bgCanvas.getContext('2d');
  var drawCtx = drawCanvas.getContext('2d');
  var overlayCtx = overlayCanvas.getContext('2d');

  var WIDTH = bgCanvas.width;
  var HEIGHT = bgCanvas.height;
  var BG_TILE_SIZE = 8;
  var PIXEL_SIZE = 32;

  var PixelGrid = [];

  function drawBackground() {
    var NUM_TILES_HORIZ = WIDTH / BG_TILE_SIZE;
    var NUM_TILES_VERT = HEIGHT / BG_TILE_SIZE;

    for (var i = 0; i < NUM_TILES_HORIZ; i++) {
      for (var j = 0; j < NUM_TILES_VERT; j++) {
        var x = i * BG_TILE_SIZE;
        var y = j * BG_TILE_SIZE;

        var fill = (i + j) % 2 == 0 ? '#999' : '#777';

        bgCtx.fillStyle = fill;
        bgCtx.fillRect(x, y, BG_TILE_SIZE, BG_TILE_SIZE);
      }
    }
  }

  function initializeDrawSurface() {
    var NUM_PIXELS_HORIZ = WIDTH / PIXEL_SIZE;
    var NUM_PIXELS_VERT = HEIGHT / PIXEL_SIZE;

    for (var x = 0; x < NUM_PIXELS_HORIZ; x++) {
      PixelGrid[x] = [];

      for (var y = 0; y < NUM_PIXELS_VERT; y++) {
        PixelGrid[x].push(new _pixel2['default'](x, y));
      }
    }
  }

  function getPixelCoordinates(ev) {
    var elRect = ev.target.getBoundingClientRect();
    var absX = ev.clientX;
    var absY = ev.clientY;
    var x = absX - elRect.left;
    var y = absY - elRect.top;

    var pixelX = Math.floor(x / PIXEL_SIZE);
    var pixelY = Math.floor(y / PIXEL_SIZE);

    return [pixelX, pixelY];
  }

  function highlightPixel(ev) {
    console.log('HIGHLIGHT');

    var _getPixelCoordinates = getPixelCoordinates(ev);

    var _getPixelCoordinates2 = _slicedToArray(_getPixelCoordinates, 2);

    var x = _getPixelCoordinates2[0];
    var y = _getPixelCoordinates2[1];

    var NUM_PIXELS = PixelGrid.length;

    // highlight the pixel under the mouse
    var currentPixel = PixelGrid[x][y];
    if (!currentPixel.highlighted) {
      var fillX = currentPixel.x * PIXEL_SIZE;
      var fillY = currentPixel.y * PIXEL_SIZE;

      overlayCtx.fillStyle = 'rgba(255, 255, 255, 0.2)';
      overlayCtx.fillRect(fillX, fillY, PIXEL_SIZE, PIXEL_SIZE);
      currentPixel.highlighted = true;
    }

    // clear highlighting on other pixels
    var NUM_PIXELS_HORIZ = WIDTH / PIXEL_SIZE;
    var NUM_PIXELS_VERT = HEIGHT / PIXEL_SIZE;
    for (var ix = 0; ix < NUM_PIXELS_HORIZ; ix++) {
      for (var iy = 0; iy < NUM_PIXELS_VERT; iy++) {
        var pixel = PixelGrid[ix][iy];
        if (pixel === currentPixel) {
          continue;
        }

        if (pixel.highlighted) {
          var fillX = pixel.x * PIXEL_SIZE;
          var fillY = pixel.y * PIXEL_SIZE;

          overlayCtx.clearRect(fillX, fillY, PIXEL_SIZE, PIXEL_SIZE);
          pixel.highlighted = false;
        }
      }
    }
  }

  function paintPixel(ev) {
    console.log('PAINT');

    var _getPixelCoordinates3 = getPixelCoordinates(ev);

    var _getPixelCoordinates32 = _slicedToArray(_getPixelCoordinates3, 2);

    var x = _getPixelCoordinates32[0];
    var y = _getPixelCoordinates32[1];

    var color = '#000000';
    var pixel = PixelGrid[x][y];

    var fillX = x * PIXEL_SIZE;
    var fillY = y * PIXEL_SIZE;
    drawCtx.fillStyle = color;
    drawCtx.fillRect(fillX, fillY, PIXEL_SIZE, PIXEL_SIZE);
    pixel.color = color;
  }

  drawBackground();
  initializeDrawSurface();
  overlayCanvas.addEventListener('mousemove', highlightPixel, false);
  overlayCanvas.addEventListener('mousedown', paintPixel, false);
});

},{"./pixel":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9hdXN0aW4vcHJvamVjdHMvYWR2ZW50dXJlLWtpdC9wdWJsaWMvanMvcGl4ZWwuanMiLCIvaG9tZS9hdXN0aW4vcHJvamVjdHMvYWR2ZW50dXJlLWtpdC9wdWJsaWMvanMvYXBwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7SUNBTSxLQUFLLEdBQ0csU0FEUixLQUFLLENBQ0ksQ0FBQyxFQUFFLENBQUMsRUFBRTt3QkFEZixLQUFLOztBQUVQLE1BQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ1gsTUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDWCxNQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztBQUN6QixNQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztDQUNuQjs7QUFDRixDQUFDOztxQkFFYSxLQUFLOzs7O0FDVHBCLFlBQVksQ0FBQzs7Ozs7O3FCQUVLLFNBQVM7Ozs7QUFFM0IsUUFBUSxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLFlBQVk7QUFDeEQsTUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUNwRCxNQUFJLFVBQVUsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ3hELE1BQUksYUFBYSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQzs7QUFFOUQsTUFBSSxLQUFLLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN0QyxNQUFJLE9BQU8sR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzFDLE1BQUksVUFBVSxHQUFHLGFBQWEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7O0FBRWhELE1B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LENBQUUsRUFBRSxFQUFFO0FBQ3ZCLFdBQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7O2dDQUNSLG1CQUFtQixDQUFDLEVBQUUsQ0FBQzs7OztRQUEvQixDQUFDO1FBQUUsQ0FBQzs7QUFDVCxRQUFJLEtBQUssR0FBRyxTQUFTLENBQUM7QUFDdEIsUUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOztBQUU1QixRQUFJLEtBQUssR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFDO0FBQzNCLFFBQUksS0FBSyxHQUFHLENBQUMsR0FBRyxVQUFVLENBQUM7QUFDM0IsV0FBTyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7QUFDMUIsV0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUN2RCxTQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztHQUNyQjs7QUFFRCxnQkFBYyxFQUFFLENBQUM7QUFDakIsdUJBQXFCLEVBQUUsQ0FBQztBQUN4QixlQUFhLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLGNBQWMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNuRSxlQUFhLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztDQUNoRSxDQUFDLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiY2xhc3MgUGl4ZWwge1xuICBjb25zdHJ1Y3RvciAoeCwgeSkge1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbiAgICB0aGlzLmhpZ2hsaWdodGVkID0gZmFsc2U7XG4gICAgdGhpcy5jb2xvciA9IG51bGw7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IFBpeGVsO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgUGl4ZWwgZnJvbSAnLi9waXhlbCc7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBiZ0NhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiZy1jYW52YXMnKTtcbiAgbGV0IGRyYXdDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJhdy1jYW52YXMnKTtcbiAgbGV0IG92ZXJsYXlDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheS1jYW52YXMnKTtcblxuICBsZXQgYmdDdHggPSBiZ0NhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICBsZXQgZHJhd0N0eCA9IGRyYXdDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgbGV0IG92ZXJsYXlDdHggPSBvdmVybGF5Q2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbiAgY29uc3QgV0lEVEggPSBiZ0NhbnZhcy53aWR0aDtcbiAgY29uc3QgSEVJR0hUID0gYmdDYW52YXMuaGVpZ2h0O1xuICBjb25zdCBCR19USUxFX1NJWkUgPSA4O1xuICBjb25zdCBQSVhFTF9TSVpFID0gMzI7XG5cbiAgbGV0IFBpeGVsR3JpZCA9IFtdO1xuXG4gIGZ1bmN0aW9uIGRyYXdCYWNrZ3JvdW5kKCkge1xuICAgIGNvbnN0IE5VTV9USUxFU19IT1JJWiA9IFdJRFRIIC8gQkdfVElMRV9TSVpFO1xuICAgIGNvbnN0IE5VTV9USUxFU19WRVJUID0gSEVJR0hUIC8gQkdfVElMRV9TSVpFO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOVU1fVElMRVNfSE9SSVo7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBOVU1fVElMRVNfVkVSVDsgaisrKSB7XG4gICAgICAgIGxldCB4ID0gaSAqIEJHX1RJTEVfU0laRTtcbiAgICAgICAgbGV0IHkgPSBqICogQkdfVElMRV9TSVpFO1xuXG4gICAgICAgIGxldCBmaWxsID0gKChpICsgaikgJSAyID09IDApID8gXCIjOTk5XCIgOiBcIiM3NzdcIjtcblxuICAgICAgICBiZ0N0eC5maWxsU3R5bGUgPSBmaWxsO1xuICAgICAgICBiZ0N0eC5maWxsUmVjdCh4LCB5LCBCR19USUxFX1NJWkUsIEJHX1RJTEVfU0laRSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaW5pdGlhbGl6ZURyYXdTdXJmYWNlKCkge1xuICAgIGNvbnN0IE5VTV9QSVhFTFNfSE9SSVogPSBXSURUSCAvIFBJWEVMX1NJWkU7XG4gICAgY29uc3QgTlVNX1BJWEVMU19WRVJUID0gSEVJR0hUIC8gUElYRUxfU0laRTtcblxuICAgIGZvciAobGV0IHggPSAwOyB4IDwgTlVNX1BJWEVMU19IT1JJWjsgeCsrKSB7XG4gICAgICBQaXhlbEdyaWRbeF0gPSBbXTtcblxuICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBOVU1fUElYRUxTX1ZFUlQ7IHkrKykge1xuICAgICAgICBQaXhlbEdyaWRbeF0ucHVzaChuZXcgUGl4ZWwoeCwgeSkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFBpeGVsQ29vcmRpbmF0ZXMoZXYpIHtcbiAgICBsZXQgZWxSZWN0ID0gZXYudGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGxldCBhYnNYID0gZXYuY2xpZW50WDtcbiAgICBsZXQgYWJzWSA9IGV2LmNsaWVudFk7XG4gICAgbGV0IHggPSBhYnNYIC0gZWxSZWN0LmxlZnQ7XG4gICAgbGV0IHkgPSBhYnNZIC0gZWxSZWN0LnRvcDtcblxuICAgIGxldCBwaXhlbFggPSBNYXRoLmZsb29yKHggLyBQSVhFTF9TSVpFKTtcbiAgICBsZXQgcGl4ZWxZID0gTWF0aC5mbG9vcih5IC8gUElYRUxfU0laRSk7XG5cbiAgICByZXR1cm4gW3BpeGVsWCwgcGl4ZWxZXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZ2hsaWdodFBpeGVsIChldikge1xuICAgIGNvbnNvbGUubG9nKFwiSElHSExJR0hUXCIpO1xuICAgIGxldCBbeCwgeV0gPSBnZXRQaXhlbENvb3JkaW5hdGVzKGV2KTtcbiAgICBjb25zdCBOVU1fUElYRUxTID0gUGl4ZWxHcmlkLmxlbmd0aDtcblxuICAgIC8vIGhpZ2hsaWdodCB0aGUgcGl4ZWwgdW5kZXIgdGhlIG1vdXNlXG4gICAgbGV0IGN1cnJlbnRQaXhlbCA9IFBpeGVsR3JpZFt4XVt5XTtcbiAgICBpZiAoIWN1cnJlbnRQaXhlbC5oaWdobGlnaHRlZCkge1xuICAgICAgbGV0IGZpbGxYID0gY3VycmVudFBpeGVsLnggKiBQSVhFTF9TSVpFO1xuICAgICAgbGV0IGZpbGxZID0gY3VycmVudFBpeGVsLnkgKiBQSVhFTF9TSVpFO1xuXG4gICAgICBvdmVybGF5Q3R4LmZpbGxTdHlsZSA9IFwicmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpXCI7XG4gICAgICBvdmVybGF5Q3R4LmZpbGxSZWN0KGZpbGxYLCBmaWxsWSwgUElYRUxfU0laRSwgUElYRUxfU0laRSk7XG4gICAgICBjdXJyZW50UGl4ZWwuaGlnaGxpZ2h0ZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIGNsZWFyIGhpZ2hsaWdodGluZyBvbiBvdGhlciBwaXhlbHNcbiAgICBsZXQgTlVNX1BJWEVMU19IT1JJWiA9IFdJRFRIIC8gUElYRUxfU0laRTtcbiAgICBsZXQgTlVNX1BJWEVMU19WRVJUID0gSEVJR0hUIC8gUElYRUxfU0laRTtcbiAgICBmb3IgKGxldCBpeCA9IDA7IGl4IDwgTlVNX1BJWEVMU19IT1JJWjsgaXgrKykge1xuICAgICAgZm9yIChsZXQgaXkgPSAwOyBpeSA8IE5VTV9QSVhFTFNfVkVSVDsgaXkrKykge1xuICAgICAgICBsZXQgcGl4ZWwgPSBQaXhlbEdyaWRbaXhdW2l5XTtcbiAgICAgICAgaWYgKHBpeGVsID09PSBjdXJyZW50UGl4ZWwpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwaXhlbC5oaWdobGlnaHRlZCkge1xuICAgICAgICAgIGxldCBmaWxsWCA9IHBpeGVsLnggKiBQSVhFTF9TSVpFO1xuICAgICAgICAgIGxldCBmaWxsWSA9IHBpeGVsLnkgKiBQSVhFTF9TSVpFO1xuXG4gICAgICAgICAgb3ZlcmxheUN0eC5jbGVhclJlY3QoZmlsbFgsIGZpbGxZLCBQSVhFTF9TSVpFLCBQSVhFTF9TSVpFKTtcbiAgICAgICAgICBwaXhlbC5oaWdobGlnaHRlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGFpbnRQaXhlbCAoZXYpIHtcbiAgICBjb25zb2xlLmxvZyhcIlBBSU5UXCIpO1xuICAgIGxldCBbeCwgeV0gPSBnZXRQaXhlbENvb3JkaW5hdGVzKGV2KTtcbiAgICBsZXQgY29sb3IgPSBcIiMwMDAwMDBcIjtcbiAgICBsZXQgcGl4ZWwgPSBQaXhlbEdyaWRbeF1beV07XG5cbiAgICBsZXQgZmlsbFggPSB4ICogUElYRUxfU0laRTtcbiAgICBsZXQgZmlsbFkgPSB5ICogUElYRUxfU0laRTtcbiAgICBkcmF3Q3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xuICAgIGRyYXdDdHguZmlsbFJlY3QoZmlsbFgsIGZpbGxZLCBQSVhFTF9TSVpFLCBQSVhFTF9TSVpFKTtcbiAgICBwaXhlbC5jb2xvciA9IGNvbG9yO1xuICB9XG5cbiAgZHJhd0JhY2tncm91bmQoKTtcbiAgaW5pdGlhbGl6ZURyYXdTdXJmYWNlKCk7XG4gIG92ZXJsYXlDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgaGlnaGxpZ2h0UGl4ZWwsIGZhbHNlKTtcbiAgb3ZlcmxheUNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBwYWludFBpeGVsLCBmYWxzZSk7XG59KTtcbiJdfQ==
