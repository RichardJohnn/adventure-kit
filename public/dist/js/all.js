(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Pixel = function Pixel(x, y) {
  _classCallCheck(this, Pixel);

  this.x = x;
  this.y = y;
  this.highlighted = false;
  this.color = null;
};

;

exports["default"] = Pixel;
module.exports = exports["default"];

},{}],2:[function(require,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _slicedToArray(arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }

var _pixel = require('./pixel');

var _pixel2 = _interopRequireDefault(_pixel);

document.addEventListener('DOMContentLoaded', function () {
  var bgCanvas = document.getElementById('bg-canvas');
  var drawCanvas = document.getElementById('draw-canvas');
  var overlayCanvas = document.getElementById('overlay-canvas');

  var bgCtx = bgCanvas.getContext('2d');
  var drawCtx = drawCanvas.getContext('2d');
  var overlayCtx = overlayCanvas.getContext('2d');

  var WIDTH = bgCanvas.width;
  var HEIGHT = bgCanvas.height;
  var BG_TILE_SIZE = 8;
  var PIXEL_SIZE = 32;

  var PixelGrid = [];

  function drawBackground() {
    var NUM_TILES_HORIZ = WIDTH / BG_TILE_SIZE;
    var NUM_TILES_VERT = HEIGHT / BG_TILE_SIZE;

    for (var i = 0; i < NUM_TILES_HORIZ; i++) {
      for (var j = 0; j < NUM_TILES_VERT; j++) {
        var x = i * BG_TILE_SIZE;
        var y = j * BG_TILE_SIZE;

        var fill = (i + j) % 2 == 0 ? '#999' : '#777';

        bgCtx.fillStyle = fill;
        bgCtx.fillRect(x, y, BG_TILE_SIZE, BG_TILE_SIZE);
      }
    }
  }

  function initializeDrawSurface() {
    var NUM_PIXELS_HORIZ = WIDTH / PIXEL_SIZE;
    var NUM_PIXELS_VERT = HEIGHT / PIXEL_SIZE;

    for (var x = 0; x < NUM_PIXELS_HORIZ; x++) {
      PixelGrid[x] = [];

      for (var y = 0; y < NUM_PIXELS_VERT; y++) {
        PixelGrid[x].push(new _pixel2['default'](x, y));
      }
    }
  }

  function getPixelCoordinates(ev) {
    var elRect = ev.target.getBoundingClientRect();
    var absX = ev.clientX;
    var absY = ev.clientY;
    var x = absX - elRect.left;
    var y = absY - elRect.top;

    var pixelX = Math.floor(x / PIXEL_SIZE);
    var pixelY = Math.floor(y / PIXEL_SIZE);

    return [pixelX, pixelY];
  }

  function highlightPixel(ev) {
    console.log('HIGHLIGHT');

    var _getPixelCoordinates = getPixelCoordinates(ev);

    var _getPixelCoordinates2 = _slicedToArray(_getPixelCoordinates, 2);

    var x = _getPixelCoordinates2[0];
    var y = _getPixelCoordinates2[1];

    var NUM_PIXELS = PixelGrid.length;

    // highlight the pixel under the mouse
    var currentPixel = PixelGrid[x][y];
    if (!currentPixel.highlighted) {
      var fillX = currentPixel.x * PIXEL_SIZE;
      var fillY = currentPixel.y * PIXEL_SIZE;

      overlayCtx.fillStyle = 'rgba(255, 255, 255, 0.2)';
      overlayCtx.fillRect(fillX, fillY, PIXEL_SIZE, PIXEL_SIZE);
      currentPixel.highlighted = true;
    }

    // clear highlighting on other pixels
    var NUM_PIXELS_HORIZ = WIDTH / PIXEL_SIZE;
    var NUM_PIXELS_VERT = HEIGHT / PIXEL_SIZE;
    for (var ix = 0; ix < NUM_PIXELS_HORIZ; ix++) {
      for (var iy = 0; iy < NUM_PIXELS_VERT; iy++) {
        var pixel = PixelGrid[ix][iy];
        if (pixel === currentPixel) {
          continue;
        }

        if (pixel.highlighted) {
          var fillX = pixel.x * PIXEL_SIZE;
          var fillY = pixel.y * PIXEL_SIZE;

          overlayCtx.clearRect(fillX, fillY, PIXEL_SIZE, PIXEL_SIZE);
          drawCtx.fillStyle = pixel.color;
          drawCtx.fillRect(fillX, fillY, PIXEL_SIZE, PIXEL_SIZE);
          pixel.highlighted = false;
        }
      }
    }
  }

  function paintPixel(ev) {
    var _getPixelCoordinates3 = getPixelCoordinates(ev);

    var _getPixelCoordinates32 = _slicedToArray(_getPixelCoordinates3, 2);

    var x = _getPixelCoordinates32[0];
    var y = _getPixelCoordinates32[1];

    var color = '#000000';
    var pixel = PixelGrid[x][y];

    var fillX = x * PIXEL_SIZE;
    var fillY = y * PIXEL_SIZE;
    drawCtx.fillStyle = color;
    drawCtx.fillRect(fillX, fillY, PIXEL_SIZE, PIXEL_SIZE);
    pixel.color = color;
  }

  drawBackground();
  initializeDrawSurface();
  overlayCanvas.addEventListener('mousemove', highlightPixel, false);
  drawCanvas.addEventListener('mousedown', paintPixel, false);
});

},{"./pixel":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9hdXN0aW4vcHJvamVjdHMvYWR2ZW50dXJlLWtpdC9wdWJsaWMvanMvcGl4ZWwuanMiLCIvaG9tZS9hdXN0aW4vcHJvamVjdHMvYWR2ZW50dXJlLWtpdC9wdWJsaWMvanMvYXBwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7SUNBTSxLQUFLLEdBQ0csU0FEUixLQUFLLENBQ0ksQ0FBQyxFQUFFLENBQUMsRUFBRTt3QkFEZixLQUFLOztBQUVQLE1BQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ1gsTUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDWCxNQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztBQUN6QixNQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztDQUNuQjs7QUFDRixDQUFDOztxQkFFYSxLQUFLOzs7O0FDVHBCLFlBQVksQ0FBQzs7Ozs7O3FCQUVLLFNBQVM7Ozs7QUFFM0IsUUFBUSxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLFlBQVk7QUFDeEQsTUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUNwRCxNQUFJLFVBQVUsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ3hELE1BQUksYUFBYSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQzs7QUFFOUQsTUFBSSxLQUFLLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN0QyxNQUFJLE9BQU8sR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzFDLE1BQUksVUFBVSxHQUFHLGFBQWEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7O0FBRWhELE1B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QyxLQUFLLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUN2RCxlQUFLLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztTQUMzQjtPQUNGO0tBQ0Y7R0FDRjs7QUFFRCxXQUFTLFVBQVUsQ0FBRSxFQUFFLEVBQUU7Z0NBQ1YsbUJBQW1CLENBQUMsRUFBRSxDQUFDOzs7O1FBQS9CLENBQUM7UUFBRSxDQUFDOztBQUNULFFBQUksS0FBSyxHQUFHLFNBQVMsQ0FBQztBQUN0QixRQUFJLEtBQUssR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7O0FBRTVCLFFBQUksS0FBSyxHQUFHLENBQUMsR0FBRyxVQUFVLENBQUM7QUFDM0IsUUFBSSxLQUFLLEdBQUcsQ0FBQyxHQUFHLFVBQVUsQ0FBQztBQUMzQixXQUFPLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztBQUMxQixXQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQ3ZELFNBQUssQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0dBQ3JCOztBQUVELGdCQUFjLEVBQUUsQ0FBQztBQUNqQix1QkFBcUIsRUFBRSxDQUFDO0FBQ3hCLGVBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsY0FBYyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ25FLFlBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0NBQzdELENBQUMsQ0FBQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJjbGFzcyBQaXhlbCB7XG4gIGNvbnN0cnVjdG9yICh4LCB5KSB7XG4gICAgdGhpcy54ID0geDtcbiAgICB0aGlzLnkgPSB5O1xuICAgIHRoaXMuaGlnaGxpZ2h0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmNvbG9yID0gbnVsbDtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgUGl4ZWw7XG4iLCIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBQaXhlbCBmcm9tICcuL3BpeGVsJztcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgbGV0IGJnQ2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JnLWNhbnZhcycpO1xuICBsZXQgZHJhd0NhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcmF3LWNhbnZhcycpO1xuICBsZXQgb3ZlcmxheUNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdmVybGF5LWNhbnZhcycpO1xuXG4gIGxldCBiZ0N0eCA9IGJnQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gIGxldCBkcmF3Q3R4ID0gZHJhd0NhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICBsZXQgb3ZlcmxheUN0eCA9IG92ZXJsYXlDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICBjb25zdCBXSURUSCA9IGJnQ2FudmFzLndpZHRoO1xuICBjb25zdCBIRUlHSFQgPSBiZ0NhbnZhcy5oZWlnaHQ7XG4gIGNvbnN0IEJHX1RJTEVfU0laRSA9IDg7XG4gIGNvbnN0IFBJWEVMX1NJWkUgPSAzMjtcblxuICBsZXQgUGl4ZWxHcmlkID0gW107XG5cbiAgZnVuY3Rpb24gZHJhd0JhY2tncm91bmQoKSB7XG4gICAgY29uc3QgTlVNX1RJTEVTX0hPUklaID0gV0lEVEggLyBCR19USUxFX1NJWkU7XG4gICAgY29uc3QgTlVNX1RJTEVTX1ZFUlQgPSBIRUlHSFQgLyBCR19USUxFX1NJWkU7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5VTV9USUxFU19IT1JJWjsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IE5VTV9USUxFU19WRVJUOyBqKyspIHtcbiAgICAgICAgbGV0IHggPSBpICogQkdfVElMRV9TSVpFO1xuICAgICAgICBsZXQgeSA9IGogKiBCR19USUxFX1NJWkU7XG5cbiAgICAgICAgbGV0IGZpbGwgPSAoKGkgKyBqKSAlIDIgPT0gMCkgPyBcIiM5OTlcIiA6IFwiIzc3N1wiO1xuXG4gICAgICAgIGJnQ3R4LmZpbGxTdHlsZSA9IGZpbGw7XG4gICAgICAgIGJnQ3R4LmZpbGxSZWN0KHgsIHksIEJHX1RJTEVfU0laRSwgQkdfVElMRV9TSVpFKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBpbml0aWFsaXplRHJhd1N1cmZhY2UoKSB7XG4gICAgY29uc3QgTlVNX1BJWEVMU19IT1JJWiA9IFdJRFRIIC8gUElYRUxfU0laRTtcbiAgICBjb25zdCBOVU1fUElYRUxTX1ZFUlQgPSBIRUlHSFQgLyBQSVhFTF9TSVpFO1xuXG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCBOVU1fUElYRUxTX0hPUklaOyB4KyspIHtcbiAgICAgIFBpeGVsR3JpZFt4XSA9IFtdO1xuXG4gICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IE5VTV9QSVhFTFNfVkVSVDsgeSsrKSB7XG4gICAgICAgIFBpeGVsR3JpZFt4XS5wdXNoKG5ldyBQaXhlbCh4LCB5KSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0UGl4ZWxDb29yZGluYXRlcyhldikge1xuICAgIGxldCBlbFJlY3QgPSBldi50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgbGV0IGFic1ggPSBldi5jbGllbnRYO1xuICAgIGxldCBhYnNZID0gZXYuY2xpZW50WTtcbiAgICBsZXQgeCA9IGFic1ggLSBlbFJlY3QubGVmdDtcbiAgICBsZXQgeSA9IGFic1kgLSBlbFJlY3QudG9wO1xuXG4gICAgbGV0IHBpeGVsWCA9IE1hdGguZmxvb3IoeCAvIFBJWEVMX1NJWkUpO1xuICAgIGxldCBwaXhlbFkgPSBNYXRoLmZsb29yKHkgLyBQSVhFTF9TSVpFKTtcblxuICAgIHJldHVybiBbcGl4ZWxYLCBwaXhlbFldO1xuICB9XG5cbiAgZnVuY3Rpb24gaGlnaGxpZ2h0UGl4ZWwgKGV2KSB7XG4gICAgY29uc29sZS5sb2coXCJISUdITElHSFRcIik7XG4gICAgbGV0IFt4LCB5XSA9IGdldFBpeGVsQ29vcmRpbmF0ZXMoZXYpO1xuICAgIGNvbnN0IE5VTV9QSVhFTFMgPSBQaXhlbEdyaWQubGVuZ3RoO1xuXG4gICAgLy8gaGlnaGxpZ2h0IHRoZSBwaXhlbCB1bmRlciB0aGUgbW91c2VcbiAgICBsZXQgY3VycmVudFBpeGVsID0gUGl4ZWxHcmlkW3hdW3ldO1xuICAgIGlmICghY3VycmVudFBpeGVsLmhpZ2hsaWdodGVkKSB7XG4gICAgICBsZXQgZmlsbFggPSBjdXJyZW50UGl4ZWwueCAqIFBJWEVMX1NJWkU7XG4gICAgICBsZXQgZmlsbFkgPSBjdXJyZW50UGl4ZWwueSAqIFBJWEVMX1NJWkU7XG5cbiAgICAgIG92ZXJsYXlDdHguZmlsbFN0eWxlID0gXCJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMilcIjtcbiAgICAgIG92ZXJsYXlDdHguZmlsbFJlY3QoZmlsbFgsIGZpbGxZLCBQSVhFTF9TSVpFLCBQSVhFTF9TSVpFKTtcbiAgICAgIGN1cnJlbnRQaXhlbC5oaWdobGlnaHRlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8gY2xlYXIgaGlnaGxpZ2h0aW5nIG9uIG90aGVyIHBpeGVsc1xuICAgIGxldCBOVU1fUElYRUxTX0hPUklaID0gV0lEVEggLyBQSVhFTF9TSVpFO1xuICAgIGxldCBOVU1fUElYRUxTX1ZFUlQgPSBIRUlHSFQgLyBQSVhFTF9TSVpFO1xuICAgIGZvciAobGV0IGl4ID0gMDsgaXggPCBOVU1fUElYRUxTX0hPUklaOyBpeCsrKSB7XG4gICAgICBmb3IgKGxldCBpeSA9IDA7IGl5IDwgTlVNX1BJWEVMU19WRVJUOyBpeSsrKSB7XG4gICAgICAgIGxldCBwaXhlbCA9IFBpeGVsR3JpZFtpeF1baXldO1xuICAgICAgICBpZiAocGl4ZWwgPT09IGN1cnJlbnRQaXhlbCkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBpeGVsLmhpZ2hsaWdodGVkKSB7XG4gICAgICAgICAgbGV0IGZpbGxYID0gcGl4ZWwueCAqIFBJWEVMX1NJWkU7XG4gICAgICAgICAgbGV0IGZpbGxZID0gcGl4ZWwueSAqIFBJWEVMX1NJWkU7XG5cbiAgICAgICAgICBvdmVybGF5Q3R4LmNsZWFyUmVjdChmaWxsWCwgZmlsbFksIFBJWEVMX1NJWkUsIFBJWEVMX1NJWkUpO1xuICAgICAgICAgIGRyYXdDdHguZmlsbFN0eWxlID0gcGl4ZWwuY29sb3I7XG4gICAgICAgICAgZHJhd0N0eC5maWxsUmVjdChmaWxsWCwgZmlsbFksIFBJWEVMX1NJWkUsIFBJWEVMX1NJWkUpO1xuICAgICAgICAgIHBpeGVsLmhpZ2hsaWdodGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwYWludFBpeGVsIChldikge1xuICAgIGxldCBbeCwgeV0gPSBnZXRQaXhlbENvb3JkaW5hdGVzKGV2KTtcbiAgICBsZXQgY29sb3IgPSBcIiMwMDAwMDBcIjtcbiAgICBsZXQgcGl4ZWwgPSBQaXhlbEdyaWRbeF1beV07XG5cbiAgICBsZXQgZmlsbFggPSB4ICogUElYRUxfU0laRTtcbiAgICBsZXQgZmlsbFkgPSB5ICogUElYRUxfU0laRTtcbiAgICBkcmF3Q3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xuICAgIGRyYXdDdHguZmlsbFJlY3QoZmlsbFgsIGZpbGxZLCBQSVhFTF9TSVpFLCBQSVhFTF9TSVpFKTtcbiAgICBwaXhlbC5jb2xvciA9IGNvbG9yO1xuICB9XG5cbiAgZHJhd0JhY2tncm91bmQoKTtcbiAgaW5pdGlhbGl6ZURyYXdTdXJmYWNlKCk7XG4gIG92ZXJsYXlDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgaGlnaGxpZ2h0UGl4ZWwsIGZhbHNlKTtcbiAgZHJhd0NhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBwYWludFBpeGVsLCBmYWxzZSk7XG59KTtcbiJdfQ==
